  % \item Further, intermediate vote counts are necessarily public. We prove
  %   generally in Appendix~\ref{Appendix:SecretProof} that we cannot do better.
% \end{itemize}
We now sketch an implementation of the specification from
Chapter~\ref{Chapter:Spec}: a simple voting protocol based on linkable ring
signatures \cite{lrs}, on top of a Hardened Dissent \cite{sec} instance that
provides instigator anonymity, along with acccountability to handle byzantine
faults. Our protocol uses this to elect servers for an instance of Dissent in
Numbers \cite{din}, which can then be used for latency-sensitive applications
without sacrificing the superior security properties of Hardened Dissent.
\section{Building Blocks}
We combine several existing cryptosystems and distributed systems to construct
our protocol.
\subsection{Hardened Dissent}
A security analysis of the original peer-to-peer Dissent resulted in a modified
protocol providing the following properties:
  \begin{theorem} At the end of round $i$, either all participants see the same
    value of all messages, any peers disrupting the protocol are detected and
    eliminated, or the round does not terminate.\todo{TODO: explain}%\ldots \todo{semicomputability}
  \end{theorem}
  \begin{theorem} For any round $i$, all participants know the results of round
    $i$ before any know the results of round
    $i+1$.\end{theorem}\label{theorem:rounds}
  \begin{theorem}[Anonymity] When Hardened Dissent is executed and completes in a
    cluster of $n$ participants, of which $k$ are honest, none of the avenues of
    attack descibed in our thread models in Section~\ref{Section:threats}
    provide non-negligable advantage over uniform guessing in determining which
    of the $k$ honest participants sent any particular message.
  \end{theorem}\label{theorem:anon}
  All properties are rigorously proven in \cite{sec}.

\subsection{Linkable Ring Signatures}
Our voting protocol is based on the concept of a linkable ring signature (LRS),
introduced in \cite{lrs}. The documentation of the CryptoBook implementation in
Go explains:
\begin{quote}
 ``The caller supplies one or more public keys representing an anonymity set, and
 the private key corresponding to one of those public keys. The resulting
 signature proves to a verifier that the owner of one of these public keys
 signed the message, without revealing which key-holder signed the message,
 offering anonymity among the members of this explicit anonymity set. The other
 users whose keys are listed in the anonymity set need not consent or even be
 aware that they have been included in an anonymity set: anyone having a
 suitable public key may be "conscripted" into a set.

If the provided anonymity set contains only one public key (the signer's), then
this function produces a traditional non-anonymous signature, equivalent in both
size and performance to a standard ElGamal signature.

The caller may request either unlinkable or linkable anonymous signatures. If
linkScope is nil, this function generates an unlinkable signature, which
contains no information about which member signed the message. The anonymity
provided by unlinkable signatures is forward-secure, in that a signature reveals
nothing about which member generated it, even if all members' private keys are
later released. For cryptographic background on unlinkable anonymity-set
signatures - also known as ring signatures or ad-hoc group signatures - see
\cite{rs}.

If the caller passes a non-nil linkScope, the resulting anonymous signature will
be linkable. This means that given two signatures produced using the same
linkScope, a verifier will be able to tell whether the same or different
anonymity set members produced those signatures. In particular, verifying a
linkable signature yields a linkage tag. This linkage tag has a 1-to-1
correspondence with the signer's public key within a given linkScope, but is
cryptographically unlinkable to either the signer's public key or to linkage
tags in other scopes. The provided linkScope may be an arbitrary byte-string;
the only significance these scopes have is whether they are equal or unequal.
For details on the linkable signature algorithm this function implements, see
\cite{lrs}.

Linkage tags may be used to protect against sock-puppetry or Sybil attacks in
situations where a verifier needs to know how many distinct members of an
anonymity set are present or signed messages in a given context. It is
cryptographically hard for one anonymity set member to produce signatures with
different linkage tags in the same scope. An important and fundamental downside,
however, is that linkable signatures do NOT offer forward-secure anonymity. If
an anonymity set member's private key is later released, it is trivial to check
whether or not that member produced a given signature. Also, anonymity set
members who did NOT sign a message could (voluntarily or under coercion) prove
that they did not sign it, e.g., simply by signing some other message in that
linkage context and noting that the resulting linkage tag comes out different.
Thus, linkable anonymous signatures are not appropriate to use in situations
where there may be significant risk that members' private keys may later be
compromised, or that members may be persuaded or coerced into revealing whether
or not they produced a signature of interest.''
\end{quote}
\cite{golrs}
\todo{TODO: explain in own words instead of having a page and a half long quote}
\subsection{Dissent in Numbers}
An instance of Dissent in Numbers consists of $n$ clients and $m$ servers.
Communication takes place in \emph{rounds}, wherein each client has an
opportunity to broadcast a message to the entire client set. Assuming $k$ of the
$n$ clients are honest, each client is guaranteed that, at the protocol level,
its message will be anonymous among the $k$ honest clients unless all servers
collude with each other.\todoword{Move the security properties to the goals
  section and only describe the functionality here} Since all clients receive
  each client's messages in a deterministic order, there is a well-defined
  sequence of rounds which we can associate with a monotonically increasing
  \emph{round ID}.

\section{Algorithms}
\subsection{Initial formation}
We assume the member set is well known, and that every member has a secure
channel through which it can communicate with every other member, and that
members remain connected. Initially, the
members organize themselves into a Peer-to-Peer Dissent
cluster \cite{p2pd} using some consensus protocol such
as Byzantine Paxos, as discussed in \cite{sec}.

The Dissent configuration file specifies the size and ordering of clients'
message slots\todogrunt{Need to define client and slot somewhere}. which will
consist of, for each of the $n$ clients: space for a \texttt{Ballot}, and space
for up to $n$ signatures so the client can sign whatever other proposals are in
play.  We only allow any given client to have one proposal at any given time.

\subsection{Peer-to-Peer Layer}
Every \texttt{Member} maintains a TCP connection to every other \texttt{Member},
and uses this to execute Hardened Dissent. The primary limitation of this
version is performance --- there is a detailed security analysis demonstrating
the anonymity preserving properties of this layer, and so we use it as a
fallback layer for reconfiguring if servers misbehave by dropping out, and for
initial setup of the Dissent in Numbers (DIN) layer.

For any instance of the DIN layer, there is a canonical \texttt{Manifest}
maintained at the P2P layer describing its parameters. The \texttt{Manifest}
consists of
\begin{itemize}
  \item A \texttt{Roster} $R$, mapping public keys to IP addresses for all
    \texttt{Client}s,
  \item A \texttt{Servers} list $S$, which is a subset of $R$,
  \item A function $t : G \to \{\textsc{True, False}\}$ mapping a set of
    signatures to an election result. So, if $t(g) = \textsc{True}$ for some
    outcome $g$\todo{clarify $G$}, then the proposal corresponding to $g$ should
    be adopted at the specified expiration round. A plausible example is the
    function which specifies what proportion of \texttt{Member}s must agree to a
    change in the composition of $R$ or $S$ in order for the change to take
    effect
\end{itemize}

When a vote to change the \texttt{Manifest} passes, the \texttt{Member}s newly
designated as servers begin running server instances of Dissent in Numbers, and
all \texttt{Member}s (including the ones now running servers) begin running
client instances.
\toadd{Describe how to
  start a Dissent instance. This is a solved problem, I just need to summarize
it.}

\subsection{Dissent-in-Numbers Layer}
\todo[inline]{TODO: Describe uses of DIN}
In its current form, Dissent in Numbers lacks the ability to handle server
faults, and it depends on a pre-existing well-known set of servers. However, it
also provides dramatically superior performance as compared with Hardened
Dissent. Our protocol adds group management, fault tolerance, and some forms of
censorship resistance to Dissent in Numbers, providing a framework for a more
versatile system.

\missingfigure{TODO: Draw the topology and a flow chart showing pseudonyms/public
keys}

\subsection{Voting with Linkable Ring Signatures}
By associating a unique link scope with each petition, we allow \texttt{Member}s
to vote by producing a signature with the current member set and the proposer's
link scope. Each \texttt{Member} that wishes to vote for the petition broadcasts
the petition along with its signature. Dissent provides acccountable, veriiable
broadcasting of anonymous messages, and so given our reliability assumptions,
every \texttt{Member} will eventually end up with a list of anonymous signatures
associated with the petition. At the specified round, each member should verify
all signatures received. If the function $t$ applied to the set of unique, valid
signatures results in \textsc{True}, then the petition passes.

\missingfigure{TODO: Illustrate the round message format, which will consist of,
  for each of the $n$ clients: space for a \texttt{Ballot}, and space for up to
$n$ signatures so the client can sign whatever other proposals are in play.  We
only allow any given client to have one proposal at any given time.}
% \begin{table}
%   \begin{adjustbox}{width=1.4\textwidth,center}
%     \begin{tabularx}{1.4\textwidth}{XXXX|XX}
%       Peer 0's slot &
%       Link scope & Proposed Manifest & Expiration
%   \cline{3-6}
%         & & \multicolumn{2}{X|}{Verifiability} & \multicolumn{2}{X}{Anonymity}
%         % \multicolumn{2}{X}{Decentralized Trust/Network}
%         \\ \cline{3-6}
%         & &            Individual  & Universal & Secret Ballots & Instigators \\
% % & Byzantine & Global Passive \\
% \cline{1-6}
% \multicolumn{1}{R|}{\multirow{3}{2cm}{\raggedleft Voting Protocols} } &
% \multicolumn{1}{X}{Neff}& yes      & yes       &                & \\ %\cline{2-6}
% \multicolumn{1}{X|}{} &
% \multicolumn{1}{X}{Kremer}         &           &                & \\ %\cline{2-6}
% \multicolumn{1}{X|}{} &
% \multicolumn{1}{X}{Juels}          &           &                & \\ \cline{1-6}
% \multicolumn{1}{R|}{\multirow{3}{2cm}{\raggedleft Consensus Protocols} } &
% \multicolumn{1}{X}{Paxos}          &           &                & \\ %\cline{2-6}
% \multicolumn{1}{X|}{} &
% \multicolumn{1}{X}{Byzantine Paxos}&           &                & \\ %\cline{2-6}
% \multicolumn{1}{X|}{} &
% \multicolumn{1}{X}{\cite{king_load_2011}}&     &                & \\ \cline{1-6}
% \multicolumn{1}{R|}{\multirow{3}{2cm}{\raggedleft Anonymity Protocols} } &
% \multicolumn{1}{X}{Tor}            &           &                & \\ %\cline{2-6}
% \multicolumn{1}{X|}{} &
% \multicolumn{1}{X}{Dissent}        &           &                & \\ %\cline{2-6}
% \multicolumn{1}{X|}{} &
% \multicolumn{1}{>{\raggedright}X}{Dissent in Numbers}&        &                & \\ \cline{1-6}
% % \multicolumn{1}{X|}{} &
% % \multicolumn{1}{X}{Juels} & & & & &\\ \cline{1-6}
% \multicolumn{1}{R}{\raggedleft This Protocol} & & & & \\ \cline{1-6}
% % \multicolumn{1}{|p{2cm}}{\multirow{3}{*}{This Protocol} } &
% % \multicolumn{1}{|p{2cm}}{} &
% % \multicolumn{1}{|p{2cm}}{} &
% % \multicolumn{1}{|p{2cm}}{} \\ \cline{1-6}
% \end{tabularx}
% \end{adjustbox}
% \end{table}
%
Within a round, each \texttt{Member} may \todosubst{Jamming by proposing
ballots??? Infinite timeouts???} transmit a \texttt{Petition}. A
\texttt{Petition} consists of:
\begin{itemize}
  \item A proposed \emph{Manifest}, as described above,
  \item A \emph{Link Scope}\todogrunt{Explain}
  % \item A collection of \texttt{Signatures}\todogrunt{Explain}
  \item A \emph{Round ID} when the ballot will expire.
\end{itemize}

Once a \emph{Petition} has been proposed, the other \texttt{Member}s have the
opportunity to \emph{vote}. A \texttt{Member} votes by transmitting the most
recent version of the \texttt{Ballot}, but with the \texttt{Signatures} field
modified to include the proposed \texttt{Manifest} signed with the voting
\texttt{Member}'s private key for this link scope.\todoword{I think this is
wrong}

By the designated expiration round, all \texttt{Member}s have enough
information to determine whether or not the \texttt{Petition} \emph{passes}:
Each \texttt{Member} should verify all signatures on the most recent
version\todosubst{What if there are conflicting versions?}
and compare the total number of valid signatures to the threshold $t$. If the
\texttt{Ballot} passes, the new server set should immediately set up the
next iteration of the DIN layer.\toadd{finish describing new setup}

\section{Arguments for Correctness}
\subsection{Verifiability}
Our protocol provides all three types of verifiability specified in
Section~\ref{Subsection:verif}.

\begin{theorem} This protocol is Verifiable\end{theorem}

\begin{proof}

  \begin{lemma}The \emph{Election state} of any \emph{Election} at
  any time is well defined. \end{lemma}
  \begin{proof}This follows from properties of peer-to-peer Dissent \cite{sec}.
    The \emph{Election State} can only be updated by transmission of messages
    (votes) over Dissent. Recall that communication proceeds in serialized
    \emph{rounds}, so by Theorem~\ref{theorem:rounds}, it is impossible for two
    \texttt{Peer}s to have conflicting versions of the election state at any
    given round.
  \end{proof}

  Given this, we know that every \texttt{Peer} has accurate knowledge of the
  election state if it has any knowledge of the election state. From here, the
  verifiability properties follow directly from the properties of linkable ring
  signatures.

  \todo[inline, caption={TODO: More proof detail}]{TODO: Here's more proof detail:

  \begin{lemma} Given accurate knowledge of the current election state $( (M,
    r), P, V)$, a \texttt{Peer} can verify that its vote has been included or
    excluded correctly.
  \end{lemma}
  \begin{proof}a \texttt{Peer} $p$ can call
    \texttt{Sign}($M.\texttt{Roster}.keys, P.\texttt{LinkScope}, m.k,
    P$)
    % \todo{TODO:Make this notation consistent}
    to produce a signature $s$,
    then examine $V$ to see if it contains $s$.
  \end{proof}
}

\end{proof}
    % Our protocol provides individual verifiability.
    %
    % --- this follows from the
    % properties of Dissent in Numbers and of linkable ring signatures.%: Since every
    % \paragraph{Lemma 1:} There is a well-defined state.
    %
    % \paragraph{Lemma 1:} Given accurate knowledge of the current election state
    % $(S, P, G)$, a \texttt{Member} $m$ can call
    % $m$.\textsc{Sign}($S.M.\texttt{Roster}.keys$,$P.\texttt{LinkScope}$,$m$.$k$,
    % $P$) to produce a signature $s$, then examine $G$ to see if it contains $s$.
    % By properties of linkable ring signatures,
    %
\subsection{Anonymity}
Although the voting protocols discussed in Section~\ref{Subsection:evoting}
provide voter anonymity (secret ballots) within an election, they do not on
their own provide instigator anonymity. This protocol provides both.

\begin{lemma} Votes are $k$-anonymous among the $k$ honest users of the system
\end{lemma}
\begin{proof} This follows directly from Theorem~\ref{theorem:anon}.\end{proof}

Using this, we can show:

\begin{theorem} This protocol provides Secret Ballots \end{theorem}
\begin{proof} Anyone monitoring traffic can trivially link a vote to its Dissent
  pseudonym, but since this changes every round \cite{sec}, this provides no
  information beyond the scope of a single petition.
\end{proof}

\begin{theorem} This protocol provides Secret Instigators \end{theorem}
\begin{proof} Similarly, since the Hardened Dissent layer runs at all times,
  every participant is essentially actively submitting an anonymous petition or
  non-petition every round, and so neither intersection attacks nor traffic
  analysis can determine the identity of the instigator of any petition.
\end{proof}

\section{Limitations and Non-Goals}
  \paragraph{Intersection Attacks:} The \texttt{Peer} and \texttt{Member} sets
  are known. In Dissent in Numbers, clients need not know the IP addresses of
  any other clients. We believe it is useful to have a protocol for a group with
  static membership.  If there is membership churn, our protocol remains
  vulnerable to intersection attacks.
  \paragraph{Coercion-Resistance:} In order to use anonymous ring signatures for
  voting, it is necessary for each signature within a scope to correspond to a
  specific member. An adversary with the power to coerce \texttt{Member}s into
  revealing their private keys after the fact may prove that a particular member
  voted a particular way\cite{lrs}.
    \todogrunt{Need some kind of analysis of why this is still
    useful despite that}
  % todo: put this somewhere
  % \paragraph{Accountability:} In the context of Dissent, accountability refers
  % to the ability of a protocol to detect and exclude participants who disrupt
  % the protocol \cite{sec}, while proving that the disruptor did
  % indeed disrupt the protocol. Such a mechanism is necessary in peer-to-peer
  % protocols like Dining Cryptographers in which a single disruptor can make
  % the result of a round unusable. In Dissent, accountability checks occur
  % without revealing the link between any message and its sender --- moreover,
  % it is not possible to deliberately exclude a participant on the basis of
  % valid messages the participant sends. That is, the Dissent accountability
  % mechanism does not break anonymity.
  \paragraph{Forward Progress:} A protocol that guarantees forward progress
  given certain conditions will eventually make progress as long as those
  conditions are met. More strict bounds on what ``eventually'' means are
  possible. In the original Dissent, for example, forward progress can be
  guaranteed if all clients follow the protocol and remain online, but not
  otherwise: The accountability mechanism was so arduous that $f$ disrupting
  clients could prevent any messages from being transmitted for $f$ hours
  \cite{verdict}. Protocols that make use of quorums
  rather than being fully peer-to-peer are able to provide stronger guarantees
  of forward progress \cite{paxos}. Since we do not handle traditional fault
  tolerance or network churn,  this is an area
  for future work \todo{lulz}
  \paragraph{Active attacks:}
  Global traffic analysis attacks only require the adversary to be able to
  monitor global traffic. If the adversary can also modify or generate
  traffic, several other attacks are possible. The adversary can launch
  \emph{man-in-the-middle} (MITM) attacks in which it impersonates Alicia,
  Badru, or one or more Tor nodes. The adversary can launch \emph{Sybil}
  attacks, in which many different Tor clients controlled by the same
  adversary join the network as individual clients. Either of these can be
  used to create \emph{Denial-of-Service} (DoS) attacks, which might either
  prevent users from connecting to Tor at all, or force Tor traffic to go
  through particular, potentially adversary-controlled, Tor nodes ---
  de-anonymizing the users.
